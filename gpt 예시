<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>약 추천 데모</title>
<style>
  body{font-family:system-ui, sans-serif; margin:0; background:#f6f7f9;}
  header{padding:14px 20px; background:#111; color:#fff; font-weight:700;}
  .wrap{display:grid; grid-template-columns:320px 1fr; gap:20px; padding:20px;}
  .panel{background:#fff; border:1px solid #e5e7eb; border-radius:14px; padding:16px;}
  .group{margin-bottom:14px;}
  .group h3{margin:0 0 8px; font-size:16px}
  .btn{display:inline-block; padding:10px 14px; border-radius:10px; border:1px solid #111; background:#111; color:#fff; cursor:pointer}
  .cards{display:grid; gap:12px}
  .card{background:#fff; border:1px solid #e5e7eb; border-radius:14px; padding:14px; display:grid; grid-template-columns:1fr 160px; gap:12px; align-items:center}
  .badge{display:inline-block; font-size:12px; padding:2px 8px; border:1px solid #e5e7eb; border-radius:999px; margin-right:6px}
  .warn{border-color:#f59e0b; color:#92400e}
  .imgbox{border:1px dashed #cbd5e1; border-radius:10px; height:120px; display:flex; align-items:center; justify-content:center}
  @media (max-width: 900px){ .wrap{grid-template-columns:1fr} .card{grid-template-columns:1fr} }
</style>
</head>
<body>
<header>약 추천 (데모)</header>

<div class="wrap">
  <!-- 왼쪽: 증상/알레르기 -->
  <section class="panel">
    <div class="group">
      <h3>증상</h3>
      <label><input type="checkbox" name="sym" value="발열"> 발열</label><br>
      <label><input type="checkbox" name="sym" value="두통"> 두통</label><br>
      <label><input type="checkbox" name="sym" value="인후통"> 인후통</label><br>
      <label><input type="checkbox" name="sym" value="코막힘"> 코막힘/콧물</label><br>
      <label><input type="checkbox" name="sym" value="소화불량"> 소화불량</label>
    </div>

    <div class="group">
      <h3>알레르기/주의</h3>
      <label><input type="checkbox" name="alg" value="아세트아미노펜"> 아세트아미노펜</label><br>
      <label><input type="checkbox" name="alg" value="NSAID"> NSAID(이부프로펜/아스피린)</label><br>
      <label><input type="checkbox" name="alg" value="유당불내증"> 유당불내증</label><br>
      <label><input type="checkbox" name="alg" value="간질환"> 간 질환</label>
    </div>

    <div class="group">
      <label>나이: <input id="age" type="number" min="0" value="18" style="width:80px"></label>
    </div>

    <button class="btn" id="run">추천 보기</button>
    <p style="font-size:12px; color:#6b7280; margin-top:10px">
      * 정보제공용입니다. 진단·처방을 대체하지 않습니다. 증상이 심하면 의료기관을 이용하세요.
    </p>
  </section>

  <!-- 오른쪽: 결과 -->
  <section class="panel">
    <div id="results" class="cards" aria-live="polite"></div>
  </section>
</div>

<script>
const MEDS = [
  {
    id:"acetaminophen_500",
    name:"아세트아미노펜 500mg",
    class:"진통·해열",
    indications:["발열","두통","근육통"],
    allergy_tags:["아세트아미노펜"],
    avoid_tags:["간질환"],
    age_min:12,
    dose:"성인 500mg 1정, 4~6시간 간격(하루 최대 3,000mg)",
    how:"물과 함께 복용, 과음 시 복용 금지",
    notes:["다른 감기약과 성분 중복 주의"],
    imgAlt:"해열제"
  },
  {
    id:"ibuprofen_200",
    name:"이부프로펜 200mg",
    class:"진통·소염",
    indications:["두통","인후통","근육통"],
    allergy_tags:["NSAID"],
    avoid_tags:[],
    age_min:12,
    dose:"200mg 1정, 6~8시간 간격",
    how:"식후 복용 권장",
    notes:["천식·위장질환 주의"],
    imgAlt:"소염진통제"
  },
  {
    id:"antihistamine",
    name:"클로르페니라민(항히스타민)",
    class:"비염·알레르기",
    indications:["코막힘","콧물","가려움"],
    allergy_tags:[],
    avoid_tags:["유당불내증"],
    age_min:12,
    dose:"1정, 8~12시간 간격(졸림 주의)",
    how:"운전 전 복용 피하기",
    notes:["졸음 유발 가능"],
    imgAlt:"항히스타민"
  },
  {
    id:"antacid",
    name:"제산제",
    class:"소화불량",
    indications:["소화불량"],
    allergy_tags:[],
    avoid_tags:[],
    age_min:0,
    dose:"표기 용법 준수",
    how:"다른 약과 간격 두고 복용",
    notes:["신장질환 주의"],
    imgAlt:"제산제"
  }
];

function recommend(meds, symptoms, allergyTags, age){
  return meds
    .filter(m => (m.age_min ?? 0) <= age)
    .filter(m => !m.allergy_tags?.some(t => allergyTags.includes(t)))
    .filter(m => !m.avoid_tags?.some(t => allergyTags.includes(t)))
    .map(m => ({...m, score: (m.indications||[]).reduce((s,tag)=> s + (symptoms.includes(tag)?1:0), 0)}))
    .filter(m => m.score > 0)
    .sort((a,b) => b.score - a.score)
    .slice(0,3);
}

function render(cards){
  const box = document.getElementById('results');
  if(cards.length===0){ box.innerHTML = `<div>조건에 맞는 추천이 없습니다. 선택을 바꿔 보세요.</div>`; return; }
  box.innerHTML = cards.map(c=>`
    <article class="card">
      <div>
        <h3 style="margin:0 0 6px">${c.name}</h3>
        <div class="badge">${c.class}</div>
        ${c.age_min>0?`<span class="badge warn">${c.age_min}세 이상</span>`:''}
        <p style="margin:8px 0 6px"><b>적응증:</b> ${c.indications.join(', ')}</p>
        <p style="margin:0 0 6px"><b>복용법:</b> ${c.dose}</p>
        <p style="margin:0 0 6px"><b>주의:</b> ${c.notes.join(' / ')}</p>
      </div>
      <div class="imgbox" aria-hidden="true">${c.imgAlt}</div>
    </article>
  `).join('');
}

document.getElementById('run').addEventListener('click', ()=>{
  const symptoms = [...document.querySelectorAll('input[name="sym"]:checked')].map(i=>i.value);
  const algs     = [...document.querySelectorAll('input[name="alg"]:checked')].map(i=>i.value);
  const age      = parseInt(document.getElementById('age').value || '0', 10);
  render(recommend(MEDS, symptoms, algs, age));
});
</script>
</body>
</html>
